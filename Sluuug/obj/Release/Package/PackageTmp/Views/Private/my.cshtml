@{
    @model Slug.Model.Users.Relations.ProfileModel
    Layout = "~/Views/Shared/private_template.cshtml";
    string dropDownListStyleClass = "";
}
@using Slug.Extensions
@using Slug.Context.Dto.Search;

<link href="~/Styles/private/my-profile-style.css" rel="stylesheet" />
<link href="~/Styles/private/profile-info-style.css" rel="stylesheet" />
<link href="~/Styles/private/album-review-style.css" rel="stylesheet" />
<link href="~/Styles/common/navigation-arrows-style.css" rel="stylesheet" />

@RenderPage("~/Views/Partial/Albums/ExpandAlbum.cshtml")

<div id="profile-cut-info">
    <div class="info-container">
        <img alt="avatar" id="img_avatar" src="@Model.AvatarResizeUri" @*onmouseout="MoveTo($('.change-avatar'), {'left':'-700px', 'top':'190px'})"*@ onclick="MoveTo($('.change-avatar'), {'left':'100px', 'top':'190px'})">
        <div class="profile-info">
            <div class="profile-info-name">
                <h2 class="parameter" id="0" onclick="edit_private_info(this.id)">@Model.Name</h2>
                <h2 class="parameter" id="1" onclick="edit_private_info(this.id)">@Model.SurName</h2>
            </div>

            <div class="profile-info-location">
                @Html.DropDownList("Countries", null, new { @id = "myCountry", @onchange = "changeCountry()" })
                @Html.DropDownList("Cities", null, new { @id = "myCity", @onchange = "SaveEditedProfileInfo(3, this.value, $('#myCountry').val(), true, false)", @class= "stylized-scrollbar" })
                <span>@Model.Age</span>
            </div>

            <div class="profile-status-container">
                @Html.DropDownList("DatingPurposeList", null, new { @onchange = "SaveEditedProfileInfo(5, this.value, null, true, false)" })
                @if (Model.purpose == DatingPurposeEnum.NoDating)
                {
                    dropDownListStyleClass = "display:none;";
                }
                <span id="with-title" style="@dropDownListStyleClass">с</span>
                @Html.DropDownList("DatingSexList", null, new { @onchange = "SaveEditedProfileInfo(6, this.value, null, true, false)", style = dropDownListStyleClass })
                @Html.DropDownList("DatingAgesList", null, new { @onchange = "SaveEditedProfileInfo(7, this.value, null, true, false)", style = dropDownListStyleClass })
                <span id="age-title" style="@dropDownListStyleClass">лет</span>
            </div>
            <div class="profile-about">
                <span id="hello-status" onmouseover="MoveTo($('.profile-info-change-status'), {'left':'0'})">@Model.HelloMessage</span>
                <div class="profile-info-change-status" onmouseover="StopMove(this)" onmouseout="MoveTo(this, { 'left': '-1000px' })">
                    <span>Изменить..</span>
                    <input type="text" maxlength="40"  id="new-greeting" value="Привет!" />
                    <button onclick="ChangeHelloMess(4, $('#new-greeting')[0].value, null, true, false)">Готово</button>
                </div>
            </div>
        </div>
        <div class="change-avatar" @*onmouseover="StopMove(this)" *@>
            <span class="close-change-avatar" onclick="MoveTo($('.change-avatar'), { 'left': '-700px' })">X</span>
            <form action="/private/upload" enctype="multipart/form-data" method="post">
                <div class="input-overflow">
                    <span>Сменить аватар</span>
                    <img alt="change avatar" id="avatar-change-img" src="https://res.cloudinary.com/dlk1sqmj4/image/upload/h_50/v1562752983/212328-200.png" />
                </div>
                <input type="file" accept=".jpg, .bmp, .png" name="upload" id="file-selector" onchange="newAvatarSelect()">
                <input type="submit" id="file-uploader" value="Готово">
            </form>
        </div>
    </div>
</div>

<div class="profile-full-info-item-wrapper">
    <div id="albums">
        <h2>Мои альбомы(@Model.Albums.Count)</h2>
        <div id="albums-container">
            @foreach (var item in Model.Albums)
            {
                Html.RenderPartial("~/Views/Partial/OwnPage/my_album_minimized.cshtml", item, new ViewDataDictionary<Slug.Model.Albums.AlbumModel>(item));
            }
        </div>
    </div>
    <div class="new-album-form">
        <input type="checkbox" id="new-album-checkbox" />
        <button class="create_new_album_button">Создать альбом</button>
        <div id="create_new_album">

            <div class="left-new-album">

                <div class="row-entry" id="tooltip-container-album">
                    <span>Название</span>
                    <input type="text" id="album-title" required>
                </div>
                <div class="row-entry">
                    <span>Описание</span>
                    <input type="text" id="album-description">
                </div>
                <div class="row-entry">
                    <span>Обложка</span>
                    <div class="album-cover">
                        <input type="file" id="album-label-input" onchange="SelectFileAvatar()" accept=".jpg, .bmp, .png">
                        <img alt="album cover" id="album-cover-img" src="https://res.cloudinary.com/dlk1sqmj4/image/upload/h_50/v1562752983/212328-200.png">
                        <span id="album-cover-img-name"></span>
                    </div>
                </div>
            </div>
            <div class="command_form">
                <input type="button" value="Готово" onclick="CreateAlbum()" />
            </div>
        </div>
    </div>
</div>
<div class="profile-full-info-item-wrapper">
    <h2>Важные события(@Model.Events.Count)</h2>
    <input type="checkbox" class="expand-checkbox" />
    <div class="expand"></div>
    <div class="expanded-info">
        @foreach (var item in Model.Events)
        {
            Html.RenderPartial("~/Views/Partial/OwnPage/events.cshtml", item, new ViewDataDictionary<Slug.Model.Users.MemorableEventsModel>(item));
        }

        <input type="checkbox" id="new_event_checkbox" />
        <button class="new_event_button">Добавить</button>
        <div id="add_event_entry">
            <div class="new-event-form">
                <div class="left-event-form">

                    <div class="row-entry" id="tooltip-container-event" name="EventTitle" tooltip_message="Назовите событие">
                        <span>Событие</span>
                        <input type="text" name="-event" property="EventTitle" required>
                    </div>
                    <div class="row-entry" id="tooltip-container-event" name="DateEvent" tooltip_message="Дата события">
                        <span>Дата события</span>
                        <input type="date" name="-event" property="DateEvent" required>
                    </div>
                    <div class="row-entry">
                        <span>Ваш комментарий</span>
                        <input type="text" name="-event" property="Text" class="user-comment">
                    </div>
                    <div class="row-entry">
                        <span>Фотографии</span>
                        <div class="album-cover">
                            <input type="file" id="event-photos-input" multiple onchange="WriteSelectedFiles(this)" accept=".jpg, .bmp, .png">
                            <img alt="album cover" id="album-cover-img" src="https://res.cloudinary.com/dlk1sqmj4/image/upload/h_50/v1562752983/212328-200.png">
                            <span id="album-cover-img-name"></span>
                        </div>
                    </div>
                    <div class="uploaded-files-to-event">

                    </div>
                </div>
                <div class="command_form">
                    <input type="button" onclick="AddProfileEntry('-event', 'tooltip-container-event', '/api/add_event', $('#event-photos-input')[0])" value="Готово">
                </div>
            </div>
        </div>
    </div>
</div>
<div class="profile-full-info-item-wrapper">
    <h2>Работа(@Model.Works.Count)</h2>
    <input type="checkbox" class="expand-checkbox" />
    <div class="expand"></div>
    <div class="expanded-info">
        @foreach (var item in Model.Works)
        {
            Html.RenderPartial("~/Views/Partial/OwnPage/work.cshtml", item, new ViewDataDictionary<Slug.Model.Users.WorkPlacesModel>(item));
        }

        <input type="checkbox" id="new_work_checkbox" />
        <button class="new_work_button">Добавить</button>
        <div id="add_work_entry">
            <div action="" class="new-work-form">
                <div class="left-work-form">

                    <div class="row-entry" id="tooltip-container-work" name="CompanyTitle" tooltip_message="Название компании">
                        <span>Компания</span>
                        <input type="text" name="-work" property="CompanyTitle" required>
                    </div>
                    <div class="row-entry" id="tooltip-container-work" name="Position" tooltip_message="Должность">
                        <span>Должность</span>
                        <input type="text" name="-work" property="Position" required>
                    </div>
                    <div class="row-entry" id="tooltip-container-work" name="Start" tooltip_message="Начало работы">
                        <span>Дата начала</span>
                        <input type="date" name="-work" property="Start" required>
                    </div>
                    <div class="row-entry">
                        <span>Дата окончания</span>
                        <div class="new-form-end-date">
                            <input type="date" name="-work" property="End" id="end_work">
                            <div class="real-time">
                                <input type="checkbox" id="work_till_now" name="-work" property="UntilNow" onclick="untill_now_date(end_work.id, this.id)">
                                <div class="circle">
                                    <div class="circle--inner circle--inner__1"></div>
                                    <div class="circle--inner circle--inner__2"></div>
                                    <div class="circle--inner circle--inner__3"></div>
                                    <div class="circle--inner circle--inner__4"></div>
                                    <div class="circle--inner circle--inner__5"></div>
                                    <div class="circle--outer"></div>
                                </div>
                                <span>По сей день?</span>
                            </div>
                        </div>
                    </div>
                    <div class="row-entry">
                        <span>Страна</span>
                        <select id="user_search_country_w" name="-work" property="Country" onchange="getCities(user_search_country_w.id, user_search_city_w.id, false)">
                            <option value="7">Россия</option>
                            <option value="380">Украина</option>
                            <option value="375">Белорусь</option>
                        </select>
                    </div>
                    <div class="row-entry">
                        <span>Город</span>
                        <select id="user_search_city_w" name="-work" property="City">
                            <option value="495">Москва</option>
                        </select>
                    </div>
                    <div class="row-entry">
                        <span>Ваш комментарий</span>
                        <input type="text" name="-work" property="Comment" class="user-comment">
                    </div>
                </div>
                <div class="command_form">
                    <input type="button" onclick="AddProfileEntry('-work','tooltip-container-work','/api/add_works', null)" value="Готово">
                </div>
            </div>
        </div>
    </div>
</div>
<div class="profile-full-info-item-wrapper">
    <h2>Образование(@Model.Educations.Count)</h2>
    <input type="checkbox" class="expand-checkbox" />
    <div class="expand"></div>
    <div class="expanded-info">
        @foreach (var item in Model.Educations)
        {
            Html.RenderPartial("~/Views/Partial/OwnPage/education.cshtml", item, new ViewDataDictionary<Slug.Model.Users.EducationModel>(item));
        }
        <input type="checkbox" id="new_educatio_checkbox" />
        <button class="new_educatio_button">Добавить</button>
        <div id="add_education_entry">
            <div class="new-education-form">
                <div class="left-education-form">
                    <div class="row-entry">
                        <span>Уровень</span>
                        <select name="-education" property="EducationType" onchange="VisibleHightShoolParameterInNewEntry(this.value)">
                            <option class="school" value="0">Школа</option>
                            <option class="hight-school" value="1">Колледж</option>
                            <option class="hight-school" value="2">Университет</option>
                        </select>
                    </div>
                    <div class="row-entry" id="speciality-new-education-entry">
                        <span>Специальность</span>
                        <input type="text" name="-education" property="Specialty" />
                    </div>

                    <div class="row-entry">
                        <span>Страна</span>
                        <select id="user_search_country" name="-education" property="Country" onchange="getCities(user_search_country.id, user_search_city.id, false)">
                            <option value="7">Россия</option>
                            <option value="380">Украина</option>
                            <option value="375">Белорусь</option>
                        </select>
                    </div>

                    <div class="row-entry">
                        <span>Город</span>
                        <select id="user_search_city" name="-education" property="City">
                            <option value="495">Москва</option>
                        </select>
                    </div>

                    <div class="row-entry" id="tooltip-container-education" name="Title" tooltip_message="Введите название">
                        <span>Название</span>
                        <input type="text" name="-education" property="Title" required>
                    </div>

                    <div class="row-entry" id="tooltip-container-education" name="Start" tooltip_message="Введите дату начала">
                        <span>Дата начала</span>
                        <input type="date" name="-education" property="Start" required>
                    </div>

                    <div class="row-entry">
                        <span>Дата окончания</span>
                        <div class="new-form-end-date" name="End">
                            <input type="date" name="-education" property="End" id="end_education">
                            <div class="real-time">
                                <input type="checkbox" id="education_till_now" name="-education" property="UntilNow" onclick="untill_now_date(end_education.id, this.id)">
                                <div class="circle">
                                    <div class="circle--inner circle--inner__1"></div>
                                    <div class="circle--inner circle--inner__2"></div>
                                    <div class="circle--inner circle--inner__3"></div>
                                    <div class="circle--inner circle--inner__4"></div>
                                    <div class="circle--inner circle--inner__5"></div>
                                    <div class="circle--outer"></div>
                                </div>
                                <span>По сей день?</span>
                            </div>
                        </div>
                    </div>

                    <div class="row-entry">
                        <span>Ваш комментарий</span>
                        <input type="text" name="-education" property="Comment" class="user-comment">
                    </div>
                </div>
                <div class="command_form">
                    <input type="button" onclick="AddProfileEntry('-education','tooltip-container-education', '/api/add_education', null)" value="Готово">
                </div>

            </div>
        </div>
    </div>
</div>


@*<div class="profile-full-info-item-wrapper">
        <h2>Стена(-0)</h2>
        <input type="checkbox" class="expand-checkbox" />
        <div class="expand"></div>
        <div class="expanded-info">
            <div class="new-post-form">
                <textarea></textarea>
                    <button>Опубликовать</button>
            </div>
        </div>
    </div>*@

<script src="~/Scripts/System/ParseFormArray.js"></script>
<script src="~/Scripts/Private/Profile/Albums.js"></script>
<script src="~/Scripts/Private/Profile/EditProfileInfo.js"></script>
<script src="~/Scripts/System/Validation.js"></script>
<script>
    function newAvatarSelect() {
        $('#file-uploader').css({ 'opacity': '1', 'z-index': '999' });
    }

    function StopMove(element) {
        var elementPosition = $(element).offset();
        $(element).offset({ 'left': elementPosition.left });
        $(element).css({ 'opacity': '1', 'z-index': '999' });
    }

    function MoveTo(element, position, delay) {
        $(element).css({ 'left': position.left, 'top': position.top, 'opacity': 1 });
    }

    function changeCountry() {
        let countryCode = $("#myCountry").val();
        console.log(countryCode);
        $.ajax({
            type: "post",
            url: "/api/cities",
            data: { countryCode },
            success: function (response) {
                console.log(response);

                let countryList = $("#myCity");
                countryList.empty();
                for (let i = 0; i < response.Cities.length; i++) {
                    countryList.append(new Option(response.Cities[i].Title, response.Cities[i].CityCode));
                }
                SaveEditedProfileInfo(3, $('#myCity').val(), $('#myCountry').val(), true, false);
            }
        });
    }
</script>
