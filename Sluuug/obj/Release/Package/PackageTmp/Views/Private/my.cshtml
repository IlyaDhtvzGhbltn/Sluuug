
@{
    Layout = "~/Views/Shared/private_view.cshtml";
    @model Slug.Model.Users.FullUserInfoModel
}
@using Slug.Extensions;

<div id="cut_info">
    <p>
        <img src=@Model.AvatarUri id="img_avatar" width="100" height="100" />
        @using (Html.BeginForm("upload", "private", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            <input type="file" name="upload" /><br>
            <input type="submit" value="@Html.Translate("Button_Change_Avatar")" />
        }
    </p>
    <p>
        <span class="parameter" id="0" style="cursor:pointer" onclick="edit_private_info(this.id)">@Model.Name </span>
        <div id="param_0"></div>
    </p>
    <p>
        <span class="parameter" id="1" style="cursor:pointer" onclick="edit_private_info(this.id)">@Model.SurName </span>
        <div id="param_1"></div>

    </p>
    <p>
        <span class="parameter" id="2" style="cursor:pointer" >@Model.Country</span>
        <div id="param_2"></div>
    </p>
        <span class="parameter" id="3" style="cursor:pointer" >@Model.Sity </span>
        <div id="param_3"></div>
    <p>
        <span>@Model.FullAges</span>
    </p>
</div>
<hr />
<div id="albums">
    <span>@Html.Translate("Text_My_Fotos")</span>
    <div id="my_albums">
        @foreach (var item in Model.Albums)
        {
            Html.RenderPartial("~/Views/Partial/OwnPage/my_album.cshtml", item, new ViewDataDictionary<Slug.Model.Albums.AlbumModel>(item));
        }
    </div>
    <div id="create_new_album">
        <p>
            <button onclick="ShowAlbumCreateForm()" id="create_new_album_button">@Html.Translate("Button_Create_Album")</button>
            <div id="create_album_form"></div>
        </p>
    </div>
</div>
<hr />
<div id="education">
    <span>@Html.Translate("Text_Education")</span>
    @foreach (var item in Model.Educations)
    {
        Html.RenderPartial("~/Views/Partial/OwnPage/education.cshtml", item, new ViewDataDictionary<Slug.Model.Users.EducationModel>(item));
    }
    <button onclick="newEducation()" class="new_educatio_button">@Html.Translate("Button_Add")</button>
    <div id="new_education"></div>
</div>

<hr />
<div id="events">
    <span>@Html.Translate("Text_Events")</span>
    @foreach (var item in Model.Events)
    {
        Html.RenderPartial("~/Views/Partial/OwnPage/events.cshtml", item, new ViewDataDictionary<Slug.Model.Users.MemorableEventsModel>(item));
    }
    <button onclick="newEvent()" class="new_event_button">@Html.Translate("Button_Add")</button>
</div>
<hr />

<div id="works">
    <span>@Html.Translate("Text_Jobs")</span>
    @foreach (var item in Model.Works)
    {
        Html.RenderPartial("~/Views/Partial/OwnPage/work.cshtml", item, new ViewDataDictionary<Slug.Model.Users.WorkPlacesModel>(item));
    }
    <button onclick="newWork()" class="new_work_button">@Html.Translate("Button_Add")</button>
</div>
<hr />

<div id="live_places">
    <span>@Html.Translate("Text_Live_Plaves")</span>
    @foreach (var item in Model.Places)
    {
        Html.RenderPartial("~/Views/Partial/OwnPage/place.cshtml", item, new ViewDataDictionary<Slug.Model.Users.LifePlacesModel>(item));
    }
    <button onclick="newLivePlace()" class="new_place_button">@Html.Translate("Button_Add")</button>
</div>
<script src="~/Scripts/System/ParseFormArray.js"></script>
<script src="~/Scripts/Common/CommonAlbums.js"></script>
<script src="~/Scripts/EditInfo.js"></script>
<script src="~/Scripts/Albums.js"></script>
<script>
    function edit_private_info(id) {
        $.ajax({
            url: "/partial/change_parameter",
            data: { param: id },
            type: "post"
        })
            .done(function (resp) {
            $('#param_' + id)[0].innerHTML = resp;
            });
    }

    function save_edit_info(id) {
        let new_val = $('#inp_param_' + id)[0].value;

        $.ajax({
            url: "/api/save_parameter",
            data: { paramNumer: id, newValue: new_val},
            type: "post"
        })
            .done(function (resp) {
                if (resp.IsSuccess) {
                    document.location.reload();
                }
                else {
                    $.ajax({
                        url: "/partial/internal_error",
                        data: {},
                        type: "post",
                        success: function (resp) {
                            gotError(resp, id);
                        }
                    })
                }
            })
    }

    function gotError(resp, id) {
        let form_change = $("#param_" + id)[0];

        form_change.innerHTML = resp;
        setTimeout(function () {
            let paramID = 'param_' + id;
            console.log(paramID);
            rollUpFoto(paramID)
        }, 2000)
    }
</script>