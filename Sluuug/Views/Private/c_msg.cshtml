
@{
    Layout = "~/Views/Shared/private_template.cshtml";
    string expiredHeight;
    string dialogMsgWrapperClass;
    string contentSecretClass;
}
@model  Slug.Model.CryptoDialogModel
@using Slug.Extensions
<link href="~/Styles/private/search-result-style.css" rel="stylesheet" />
<link href="~/Styles/private/secret-dialog-style.css" rel="stylesheet" />
<div class="active-chat-period">
    @if (Model.NotExpired)
    {
        <span>
            Осталось : <span class="experation-mins">@Model.MinsLeft</span> мин
            <span class="experation-sec">@Model.SecLeft</span> сек
        </span>
    }
</div>

@{
    if (Model.NotExpired)
    {
        expiredHeight = "height:320px;";
    }
    else
    {
        expiredHeight = "";
    }
}

<div class="dialog stylized-scrollbar" style="@expiredHeight">
    @if (Model.TotalDialogMessagesCount > Model.Messages.Count)
    {
        <div class="old-dialog-page" current="@Model.Messages.Count"></div>
    }
    @foreach (var msg in Model.Messages)
    {
        if (msg.IsIncomming)
        {
            dialogMsgWrapperClass = "dialog-msg-wrapper-in";
            contentSecretClass = "in-content-secret";
        }
        else
        {
            dialogMsgWrapperClass = "dialog-msg-wrapper-out";
            contentSecretClass = "out-content-secret";
        }
        <div class="@dialogMsgWrapperClass">
            <div class="@contentSecretClass container-in-out">
                <div class="crypto-message-header">
                    <h4 style="cursor:pointer" onclick="redirectToUser(@msg.UserSenderId)">@msg.Name @msg.SurName</h4>
                    <span>@msg.SendingDate</span>
                    <img alt="lock image" class="lock-msg-img" src="https://res.cloudinary.com/dlk1sqmj4/image/upload/v1579432789/system/lock.svg">
                </div>
                <div class="crypto-message-body">
                    <div>
                        <img style="cursor:pointer" alt="avatar" onclick="redirectToUser(@msg.UserSenderId)" src="@msg.AvatatURI" />
                    </div>
                    <span class="crypt-message">@msg.Text</span>
                </div>
            </div>
        </div>
    }
</div>

@if (Model.NotExpired)
{
    <div class="send_msg">
        <div class="text-area-container">
            <textarea id="new_text" class="stylized-scrollbar"></textarea>
            <button id="sendButton" onclick="SendCryptoMessage()">@Html.Translate("Button_Send_Message")</button>
        </div>
    </div>

}
@*<div class="result-pagination stylized-scrollbar">
    @for (int i = 1; i <= Model.PagesCount; i++)
    {
        <div class="search-link-container" id="pagination-link-@i">
            <a href="@Url.Action("c_msg","private", new { id=Model.GuidId, page=i })">@i</a>
        </div>
    }
</div>*@
<span id="myAvatar" style="display:none">@ViewBag.MyAvatar</span>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
<script src="~/Scripts/Private/Dialogs/CryptoDialog/Сommunication.js"></script>
<script src="~/Scripts/Private/Dialogs/CryptoDialog/ExperationTimer.js"></script>
<script>

    $(document).ready(function () {
        var objDiv = $(".dialog")[0];
        objDiv.scrollTop = objDiv.scrollHeight;
    });
    StartTimer();
</script>
